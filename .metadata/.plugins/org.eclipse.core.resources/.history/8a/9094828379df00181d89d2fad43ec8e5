/*
 * tables.cpp
 *
 *  Created on: 27 окт. 2018 г.
 *      Author: user
 */


// temporary file for test sin generation
#include "tables.h"

void prepareSin(uint16_t **outBuf) {
	float sin_1000_smp[SIN_1000_SMP_SZ] = {
			 0.00000,     0.00628,     0.01257,     0.01885,     0.02513,
			 0.03769,     0.04397,     0.05024,     0.05652,     0.06279,
			 0.07533,     0.08159,     0.08785,     0.09411,     0.10036,
			 0.11286,     0.11910,     0.12533,     0.13156,     0.13779,
			 0.15023,     0.15643,     0.16264,     0.16883,     0.17502,
			 0.18738,     0.19355,     0.19971,     0.20586,     0.21201,
			 0.22427,     0.23039,     0.23650,     0.24260,     0.24869,
			 0.26084,     0.26690,     0.27295,     0.27899,     0.28502,
			 0.29704,     0.30304,     0.30902,     0.31499,     0.32094,
			 0.33282,     0.33874,     0.34464,     0.35053,     0.35641,
			 0.36812,     0.37396,     0.37978,     0.38558,     0.39137,
			 0.40291,     0.40865,     0.41438,     0.42009,     0.42578,
			 0.43712,     0.44276,     0.44838,     0.45399,     0.45958,
			 0.47070,     0.47624,     0.48175,     0.48725,     0.49273,
			 0.50362,     0.50904,     0.51444,     0.51982,     0.52517,
			 0.53583,     0.54112,     0.54639,     0.55165,     0.55688,
			 0.56727,     0.57243,     0.57757,     0.58269,     0.58779,
			 0.59790,     0.60293,     0.60793,     0.61291,     0.61786,
			 0.62769,     0.63257,     0.63742,     0.64225,     0.64706,
			 0.65659,     0.66131,     0.66601,     0.67069,     0.67533
	};

	packForCodec(sin_1000_smp, SIN_1000_SMP_SZ, outBuf);
}



// function for converting [-1..1] float to [0..FFFF] uint16_t
// > flo - float array
// > size - float array size
// > outBuf - uint16_t array, must be 2 times bigger than flo
void packForCodec(float *flo, uint32_t size, uint16_t **outBuf) {
	uint32_t temp;
	for(uint32_t i = 0; i < size*2; i+=2) {
		temp = (uint32_t) ( (flo[i/2] + 1)/2 * 0xFFFF );
		*(outBuf)[i] =   (temp) >> 16;     // High 16 bits
		*(outBuf)[i+1] = (temp) & 0xFFFF;  // Low  16 bits
		//  11111111 11111111|11111111 xxxxxxxx
		//      outBuf[i]    |    outBuf[i+1] ^=> discarded by I2S hardware
	}
}

