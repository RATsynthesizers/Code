/*
 * sequencer.cpp
 *
 *  Created on: Nov 4, 2018
 *      Author: Roman
 */

#include <Sequencer.hpp>

Sequencer::Sequencer() : prevTime(0), currStep(0) { };

void triggerStep(SeqStep step) {
	SendNoteOn( &(step.note) );
	HAL_Delay(step.length);       // ?? stupid
	SendNoteOff( &(step.note) );  // noteOff with same velocity
	HAL_Delay(step.length);       // stupid monophonic
}

void Sequencer::advanceStep(void) {
	if(sequence[currStep].jumpTo != NULL)
		currStep = sequence[currStep].jumpTo;
	else
		currStep++;

	if (sequence[currStep].repeats)
		for(u8 i = 0; i < sequence[currStep].repeats; i++) {
			triggerStep(sequence[currStep]);
		}
	else
		triggerStep(sequence[currStep]);

}
